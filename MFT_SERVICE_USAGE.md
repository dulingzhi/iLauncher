# MFT Service ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°
`mft_service.exe` æ˜¯ä¸€ä¸ªäºŒåˆä¸€çš„ MFT æ‰«æå’Œç›‘æ§æœåŠ¡ï¼Œå¯åŠ¨æ—¶ä¼šï¼š
1. **é˜¶æ®µ 1**: å¯¹æŒ‡å®šé©±åŠ¨å™¨è¿›è¡Œå…¨é‡æ‰«æï¼ˆå¤šçº¿ç¨‹å¹¶è¡Œï¼‰
2. **é˜¶æ®µ 2**: æ‰«æå®Œæˆåè‡ªåŠ¨åˆ‡æ¢åˆ°å®æ—¶ç›‘æ§æ¨¡å¼

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•ï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
.\mft_service.exe --output "D:/mft_db"
```

### æŒ‡å®šé©±åŠ¨å™¨
```powershell
# ä»…å¤„ç† C å’Œ D ç›˜
.\mft_service.exe --output "D:/mft_db" --drives C,D
```

### ä»…æ‰«æä¸€æ¬¡ï¼ˆä¸å¯åŠ¨ç›‘æ§ï¼‰
```powershell
# æ‰«æå®Œæˆåç«‹å³é€€å‡º
.\mft_service.exe --output "D:/mft_db" --scan-only
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `--output` | `-o` | æ•°æ®åº“è¾“å‡ºç›®å½• | é…ç½®æ–‡ä»¶ä¸­çš„ `output_dir` |
| `--drives` | `-d` | è¦å¤„ç†çš„é©±åŠ¨å™¨ï¼ˆé€—å·åˆ†éš”ï¼‰ | é…ç½®æ–‡ä»¶ä¸­çš„ `drives` |
| `--scan-only` | - | ä»…æ‰§è¡Œæ‰«æï¼Œä¸å¯åŠ¨ç›‘æ§ | `false` |

## é…ç½®æ–‡ä»¶

é»˜è®¤é…ç½®æ–‡ä»¶ï¼š`scan_config.json`

```json
{
  "drives": ["C", "D"],
  "output_dir": "D:/mft_db",
  "ignore_paths": [
    "$Recycle.Bin",
    "System Volume Information",
    "Windows\\WinSxS",
    "Windows\\Temp",
    "AppData\\Local\\Temp"
  ]
}
```

## è¿è¡Œæµç¨‹

### é˜¶æ®µ 1: å…¨é‡æ‰«æ
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Phase 1: Full Disk Scan                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“€ Starting scan for drive C:
ğŸ” Building FRN map (Phase 1)...
âœ“ FRN map built: 1234567 entries
ğŸ’¾ Rebuilding paths and saving to database (Phase 2)...
âœ… Drive C scan completed

â±ï¸  Total scan time: 45.23s
âœ“ Successfully scanned drives: ['C', 'D']
```

### é˜¶æ®µ 2: å®æ—¶ç›‘æ§
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    Phase 2: Real-time Monitoring          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‘€ Starting monitor for drive C:
ğŸ‘€ Starting monitor for drive D:
âœ“ All monitors started
ğŸ’¡ Press Ctrl+C to stop monitoring and exit

   â• Created: C:\Users\Documents\new_file.txt
   âœï¸  Renamed: C:\Users\Downloads\renamed.pdf
   ğŸ—‘ï¸  Deleted: C:\Temp\old_file.tmp
```

## åœæ­¢æœåŠ¡

æŒ‰ `Ctrl+C` ä¼˜é›…é€€å‡ºï¼š
```
ğŸ›‘ Received shutdown signal, stopping monitors...
ğŸ›‘ Stop signal received, exiting monitor loop for drive C
âœ“ Monitor for drive C stopped gracefully
ğŸ‰ MFT Service stopped successfully
```

## æŠ€æœ¯ç»†èŠ‚

### FRN æ˜ å°„æœºåˆ¶
- **Phase 1**: æ„å»º FRN â†’ {ParentFRN, Filename} æ˜ å°„è¡¨
- **Phase 2**: é€’å½’æŸ¥è¯¢é‡å»ºå®Œæ•´è·¯å¾„ (`C:\Users\Documents\file.txt`)

### æ•°æ®åº“ç»“æ„
- **41 ä¸ª list è¡¨**ï¼ˆlist0 - list40ï¼‰åŸºäº ASCII æ€»å’Œåˆ†åŒº
- **æ‰¹é‡æ’å…¥ä¼˜åŒ–**ï¼šæ¯ 100,000 æ¡è®°å½•æäº¤ä¸€æ¬¡äº‹åŠ¡
- **WAL æ¨¡å¼**ï¼šæå‡å¹¶å‘æ€§èƒ½

### ç›‘æ§åŸç†
- ä½¿ç”¨ Windows USN Journal APIï¼ˆ`FSCTL_READ_USN_JOURNAL`ï¼‰
- **é˜»å¡å¼ç›‘å¬**ï¼šçº¿ç¨‹ä¼‘çœ ç›´åˆ°æœ‰æ–‡ä»¶å˜åŒ–
- æ”¯æŒæ–‡ä»¶åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åäº‹ä»¶

## æ€§èƒ½å‚è€ƒ

- **æ‰«æé€Ÿåº¦**: ~100 ä¸‡æ–‡ä»¶/ç§’ï¼ˆSSDï¼‰
- **ç›‘æ§å»¶è¿Ÿ**: <100msï¼ˆå®æ—¶å“åº”ï¼‰
- **å†…å­˜å ç”¨**: ~50MBï¼ˆ100 ä¸‡æ–‡ä»¶çš„ FRN æ˜ å°„è¡¨ï¼‰

## æ³¨æ„äº‹é¡¹

âš ï¸ **å¿…é¡»ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ**ï¼ˆéœ€è¦è®¿é—® USN Journalï¼‰

âš ï¸ **é¦–æ¬¡æ‰«æè€—æ—¶è¾ƒé•¿**ï¼ˆå–å†³äºæ–‡ä»¶æ•°é‡ï¼‰

âš ï¸ **ç›‘æ§çº¿ç¨‹å¸¸é©»å†…å­˜**ï¼ˆä¿æŒ FRN æ˜ å°„è¡¨ï¼‰

## ä¸æ—§ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ (mft_service) |
|------|--------|----------------------|
| è¿›ç¨‹æ•° | 2 ä¸ªï¼ˆscanner + monitorï¼‰ | 1 ä¸ªï¼ˆäºŒåˆä¸€ï¼‰ |
| å¯åŠ¨æ–¹å¼ | æ‰‹åŠ¨åˆ†åˆ«å¯åŠ¨ | è‡ªåŠ¨åˆ‡æ¢é˜¶æ®µ |
| è·¯å¾„é‡å»º | âŒ ç¼ºå¤± | âœ… å®Œæ•´å®ç° |
| ç›‘æ§æ¨¡å¼ | ç‹¬ç«‹è¿›ç¨‹ | æ‰«æåè‡ªåŠ¨å¯åŠ¨ |
| åœæ­¢ä¿¡å· | æ—  | Ctrl+C ä¼˜é›…é€€å‡º |

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ‰«æå¤±è´¥
```
âŒ Drive C scan failed: Administrator privileges required
```
**è§£å†³**ï¼šå³é”® â†’ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ

### é—®é¢˜ï¼šè·¯å¾„ä¸å®Œæ•´
```
åªæœ‰æ–‡ä»¶å "file.txt" è€Œé "C:\Users\file.txt"
```
**è§£å†³**ï¼šç¡®ä¿ä½¿ç”¨äº† `mft_service.exe`ï¼ˆå·²å®ç° FRN æ˜ å°„ï¼‰

### é—®é¢˜ï¼šç›‘æ§æ— å“åº”
```
æ–‡ä»¶å˜åŒ–æœªè¢«æ£€æµ‹åˆ°
```
**è§£å†³**ï¼šæ£€æŸ¥é©±åŠ¨å™¨æ˜¯å¦ä¸º NTFS æ ¼å¼ï¼ŒUSN Journal æ˜¯å¦å¯ç”¨
